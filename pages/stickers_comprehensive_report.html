<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØªÙ‚Ø±ÙŠØ± Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ - Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../css/print-template.css">
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
    }
    .header {
      background-color: #6B5536;
      color: white;
      padding: 15px 0;
      margin-bottom: 30px;
    }
    .logo {
      max-width: 80px;
      margin-left: 15px;
    }
    .stat-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: transform 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .stat-card h3 {
      font-size: 2.5em;
      margin: 10px 0;
      color: #6B5536;
    }
    .stat-card p {
      margin: 0;
      color: #666;
      font-size: 1.1em;
    }
    .stat-card.success { border-right: 5px solid #28a745; }
    .stat-card.warning { border-right: 5px solid #ffc107; }
    .stat-card.danger { border-right: 5px solid #dc3545; }
    .stat-card.info { border-right: 5px solid #17a2b8; }
    .stat-card.primary { border-right: 5px solid #6B5536; }
    
    .report-section {
      background: white;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    .report-section h4 {
      color: #6B5536;
      border-bottom: 2px solid #6B5536;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }
    .table thead {
      background-color: #6B5536;
      color: white;
    }
    .nav-tabs .nav-link.active {
      background-color: #6B5536;
      color: white;
      border-color: #6B5536;
    }
    .nav-tabs .nav-link {
      color: #6B5536;
    }
    .btn-primary {
      background-color: #6B5536;
      border-color: #6B5536;
    }
    .btn-primary:hover {
      background-color: #154360;
      border-color: #154360;
    }
    .back-btn {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .back-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
      color: white;
    }
    .badge-duplicate {
      background-color: #ffc107;
      color: #000;
    }
    .badge-missing {
      background-color: #dc3545;
      color: white;
    }
    .badge-valid {
      background-color: #28a745;
      color: white;
    }
    .filter-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    /* Print styles are now in print-template.css */
    @media (max-width: 768px) {
      .stat-card h3 {
        font-size: 1.8em;
      }
      .table {
        font-size: 0.9em;
      }
    }
  </style>
</head>
<body>
  <div class="header no-print">
    <div class="container">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <img src="../assets/Ø´Ø¹Ø§Ø±.jpg" alt="Ø´Ø¹Ø§Ø± Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©" class="logo">
          <h1>ØªÙ‚Ø±ÙŠØ± Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„</h1>
        </div>
        <a href="unified_dashboard.html" class="back-btn">
          <i class="fas fa-home"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        </a>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stat-card primary">
          <i class="fas fa-id-card fa-3x mb-3" style="color: #6B5536;"></i>
          <h3 id="totalStickers">0</h3>
          <p><i class="fas fa-hashtag"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card success">
          <i class="fas fa-user fa-3x mb-3" style="color: #28a745;"></i>
          <h3 id="totalResidents">0</h3>
          <p><i class="fas fa-users"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙƒØ§Ù†</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card info">
          <i class="fas fa-building fa-3x mb-3" style="color: #17a2b8;"></i>
          <h3 id="totalBuildings">0</h3>
          <p><i class="fas fa-city"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card warning">
          <i class="fas fa-copy fa-3x mb-3" style="color: #ffc107;"></i>
          <h3 id="duplicateStickers">0</h3>
          <p><i class="fas fa-exclamation-triangle"></i> Ù…Ù„ØµÙ‚Ø§Øª Ù…ØªÙƒØ±Ø±Ø©</p>
        </div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stat-card danger">
          <i class="fas fa-exclamation-circle fa-3x mb-3" style="color: #dc3545;"></i>
          <h3 id="missingStickers">0</h3>
          <p><i class="fas fa-question"></i> Ù…Ù„ØµÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card success">
          <i class="fas fa-check-circle fa-3x mb-3" style="color: #28a745;"></i>
          <h3 id="occupiedUnits">0</h3>
          <p><i class="fas fa-home"></i> ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card info">
          <i class="fas fa-door-open fa-3x mb-3" style="color: #17a2b8;"></i>
          <h3 id="vacantUnits">0</h3>
          <p><i class="fas fa-inbox"></i> ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©</p>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card primary">
          <i class="fas fa-percentage fa-3x mb-3" style="color: #6B5536;"></i>
          <h3 id="occupancyRate">0%</h3>
          <p><i class="fas fa-chart-pie"></i> Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4 no-print" id="reportTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="by-resident-tab" data-bs-toggle="tab" data-bs-target="#by-resident" type="button" role="tab">
          <i class="fas fa-user"></i> Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§ÙƒÙ†
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="by-building-tab" data-bs-toggle="tab" data-bs-target="#by-building" type="button" role="tab">
          <i class="fas fa-building"></i> Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù†Ù‰
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="by-unit-tab" data-bs-toggle="tab" data-bs-target="#by-unit" type="button" role="tab">
          <i class="fas fa-door-closed"></i> Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="duplicates-tab" data-bs-toggle="tab" data-bs-target="#duplicates" type="button" role="tab">
          <i class="fas fa-copy"></i> Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="missing-tab" data-bs-toggle="tab" data-bs-target="#missing" type="button" role="tab">
          <i class="fas fa-exclamation-circle"></i> Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ©
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="matching-tab" data-bs-toggle="tab" data-bs-target="#matching" type="button" role="tab">
          <i class="fas fa-equals"></i> Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="occupancy-tab" data-bs-toggle="tab" data-bs-target="#occupancy" type="button" role="tab">
          <i class="fas fa-home"></i> Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª
        </button>
      </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="reportTabsContent">
      <!-- By Resident -->
      <div class="tab-pane fade show active" id="by-resident" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-user"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§ÙƒÙ†</h4>
          <div class="filter-section no-print">
            <div class="row">
              <div class="col-md-4">
                <input type="text" class="form-control" id="searchResident" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†...">
              </div>
              <div class="col-md-3">
                <select class="form-select" id="filterBuilding">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</option>
                </select>
              </div>
              <div class="col-md-3">
                <select class="form-select" id="filterMultipleCars">
                  <option value="">Ø§Ù„ÙƒÙ„</option>
                  <option value="multiple">Ø³ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡Ù… Ø£ÙƒØ«Ø± Ù…Ù† Ø³ÙŠØ§Ø±Ø©</option>
                  <option value="single">Ø³ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡Ù… Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ø­Ø¯Ø©</option>
                </select>
              </div>
              <div class="col-md-2">
                <button class="btn btn-primary w-100" onclick="applyResidentFilter()">
                  <i class="fas fa-filter"></i> ØªØµÙÙŠØ©
                </button>
              </div>
            </div>
          </div>
          <div class="table-responsive mt-3">
            <table class="table table-striped table-hover" id="residentTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th><i class="fas fa-door-closed"></i> Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                  <th><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚</th>
                  <th><i class="fas fa-car"></i> Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                  <th><i class="fas fa-car"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                  <th><i class="fas fa-hashtag"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="residentTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- By Building -->
      <div class="tab-pane fade" id="by-building" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-building"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù†Ù‰</h4>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="buildingTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th><i class="fas fa-users"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†</th>
                  <th><i class="fas fa-id-card"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</th>
                  <th><i class="fas fa-home"></i> ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©</th>
                  <th><i class="fas fa-door-open"></i> ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©</th>
                  <th><i class="fas fa-percentage"></i> Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</th>
                </tr>
              </thead>
              <tbody id="buildingTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- By Unit -->
      <div class="tab-pane fade" id="by-unit" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-door-closed"></i> ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙˆØ­Ø¯Ø©</h4>
          <div class="filter-section no-print">
            <div class="row">
              <div class="col-md-6">
                <select class="form-select" id="unitBuildingFilter">
                  <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ</option>
                </select>
              </div>
              <div class="col-md-6">
                <select class="form-select" id="unitStatusFilter">
                  <option value="">ÙƒÙ„ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</option>
                  <option value="occupied">Ù…Ø´ØºÙˆÙ„Ø©</option>
                  <option value="vacant">Ø´Ø§ØºØ±Ø©</option>
                </select>
              </div>
            </div>
            <div class="row mt-2">
              <div class="col-md-12">
                <button class="btn btn-primary" onclick="applyUnitFilter()">
                  <i class="fas fa-filter"></i> ØªØµÙÙŠØ©
                </button>
              </div>
            </div>
          </div>
          <div class="table-responsive mt-3">
            <table class="table table-striped table-hover" id="unitTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th><i class="fas fa-door-closed"></i> Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                  <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§ÙƒÙ†</th>
                  <th><i class="fas fa-id-card"></i> Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª</th>
                  <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
                </tr>
              </thead>
              <tbody id="unitTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Duplicates -->
      <div class="tab-pane fade" id="duplicates" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-copy"></i> Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙƒØ±Ø§Ø± Ù„Ù„Ø³ÙƒØ§Ù† Ø§Ù„Ø°ÙŠÙ† Ù„Ø¯ÙŠÙ‡Ù… Ø£ÙƒØ«Ø± Ù…Ù† Ø³ÙŠØ§Ø±Ø©)</h4>
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© Ù„Ù†ÙØ³ Ø§Ù„Ø³Ø§ÙƒÙ† ØªØ¹ØªØ¨Ø± Ø·Ø¨ÙŠØ¹ÙŠØ© (Ø³ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©)
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="duplicatesTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚</th>
                  <th><i class="fas fa-hashtag"></i> Ø¹Ø¯Ø¯ Ø§Ù„ØªÙƒØ±Ø§Ø±</th>
                  <th><i class="fas fa-users"></i> Ø§Ù„Ø³ÙƒØ§Ù†</th>
                  <th><i class="fas fa-exclamation-triangle"></i> Ù†ÙˆØ¹ Ø§Ù„ØªÙƒØ±Ø§Ø±</th>
                </tr>
              </thead>
              <tbody id="duplicatesTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Missing -->
      <div class="tab-pane fade" id="missing" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-exclamation-circle"></i> Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ù†Ø§Ù‚ØµØ© (Ø£Ø±Ù‚Ø§Ù… Ø£Ùˆ Ø£Ø­Ø±Ù)</h4>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="missingTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚</th>
                  <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§ÙƒÙ†</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th><i class="fas fa-door-closed"></i> Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                  <th><i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ù…Ø´ÙƒÙ„Ø©</th>
                </tr>
              </thead>
              <tbody id="missingTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Matching -->
      <div class="tab-pane fade" id="matching" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-equals"></i> Ù…Ø·Ø§Ø¨Ù‚Ø© Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª Ù…Ø¹ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù„ÙˆØ­Ø§Øª</h4>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="matchingTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§ÙƒÙ†</th>
                  <th><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚</th>
                  <th><i class="fas fa-car"></i> Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                  <th><i class="fas fa-check-circle"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©</th>
                </tr>
              </thead>
              <tbody id="matchingTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Occupancy -->
      <div class="tab-pane fade" id="occupancy" role="tabpanel">
        <div class="report-section">
          <h4><i class="fas fa-home"></i> Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ­Ø¯Ø§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© (Ù…Ø´ØºÙˆÙ„Ø© / Ø´Ø§ØºØ±Ø©)</h4>
          <div class="row mb-3">
            <div class="col-md-6">
              <div class="card">
                <div class="card-body text-center">
                  <h2 class="text-success" id="occupiedUnitsDetail">0</h2>
                  <p>ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©</p>
                </div>
              </div>
            </div>
            <div class="col-md-6">
              <div class="card">
                <div class="card-body text-center">
                  <h2 class="text-info" id="vacantUnitsDetail">0</h2>
                  <p>ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©</p>
                </div>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-striped table-hover" id="occupancyTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù…Ø¨Ù†Ù‰</th>
                  <th><i class="fas fa-home"></i> Ù…Ø´ØºÙˆÙ„Ø©</th>
                  <th><i class="fas fa-door-open"></i> Ø´Ø§ØºØ±Ø©</th>
                  <th><i class="fas fa-chart-pie"></i> Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ­Ø¯Ø§Øª</th>
                  <th><i class="fas fa-percentage"></i> Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„</th>
                </tr>
              </thead>
              <tbody id="occupancyTableBody">
                <!-- Will be populated dynamically -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4 no-print">
      <div class="col-md-12">
        <button class="btn btn-success me-2" onclick="exportToExcel()">
          <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
        </button>
        <button class="btn btn-primary me-2" onclick="exportToPDF()">
          <i class="fas fa-file-pdf"></i> ØªØµØ¯ÙŠØ± PDF
        </button>
        <button class="btn btn-info" onclick="window.print()">
          <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
        </button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- Excel Export Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- PDF Export Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script>
    let allStickers = [];
    let allResidents = [];

    // Load data on page load
    document.addEventListener('DOMContentLoaded', async function() {
      await loadData();
      
      if (allStickers.length === 0) {
        // Show message if no data
        document.querySelector('.container').innerHTML = `
          <div class="alert alert-warning text-center" role="alert">
            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
            <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø©</h4>
            <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù stickers_data.json Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</p>
            <a href="unified_dashboard.html" class="btn btn-primary mt-3">
              <i class="fas fa-home"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
          </div>
        `;
      } else {
        displayAllReports();
      }
    });

    async function loadData() {
      try {
        // Load from the properly formatted vehicle_stickers.json file
        const response = await fetch('../data/vehicle_stickers.json');
        if (response.ok) {
          const jsonData = await response.json();
          // Filter only active stickers
          allStickers = jsonData.filter(item => item.status === 'ÙØ¹Ø§Ù„');
          console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† vehicle_stickers.json:', allStickers.length, 'Ù…Ù„ØµÙ‚ ÙØ¹Ø§Ù„');
          return;
        }
      } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
      }
      
      // No data available
      console.warn('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª');
      allStickers = [];
    }



    function displayAllReports() {
      // Show a loading message
      document.getElementById('residentTableBody').innerHTML = '<tr><td colspan="8" class="text-center"><i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>';
      
      // Update statistics first (lightweight)
      updateStatistics();
      
      // Then load reports one by one with small delays
      setTimeout(() => {
        displayByResident();
        populateFilters();
      }, 100);
      
      setTimeout(() => displayByBuilding(), 200);
      setTimeout(() => displayByUnit(), 300);
      setTimeout(() => displayDuplicates(), 400);
      setTimeout(() => displayMissing(), 500);
      setTimeout(() => displayMatching(), 600);
      setTimeout(() => displayOccupancy(), 700);
    }

    function updateStatistics() {
      const totalStickers = allStickers.length;
      const uniqueResidents = [...new Set(allStickers.map(s => s.residentName))].length;
      const uniqueBuildings = [...new Set(allStickers.map(s => s.building).filter(b => b && b !== ''))].length;
      
      // Find duplicates based on sticker number
      const stickerCounts = {};
      allStickers.forEach(s => {
        if (s.stickerNumber) {
          stickerCounts[s.stickerNumber] = (stickerCounts[s.stickerNumber] || 0) + 1;
        }
      });
      const duplicates = Object.values(stickerCounts).filter(count => count > 1).length;
      
      // Find missing data
      const missing = allStickers.filter(s => 
        !s.stickerNumber || !s.plateNumber || s.stickerNumber.length < 4
      ).length;
      
      // Calculate occupancy - count unique building-unit combinations
      const occupiedUnits = [...new Set(
        allStickers
          .filter(s => s.building && s.apartment && s.apartment !== '0')
          .map(s => `${s.building}-${s.apartment}`)
      )].length;
      
      // Estimate total units (assume 80 units per building on average)
      const estimatedUnitsPerBuilding = 80;
      const totalUnits = uniqueBuildings > 0 ? uniqueBuildings * estimatedUnitsPerBuilding : 0;
      const vacant = totalUnits > occupiedUnits ? totalUnits - occupiedUnits : 0;
      const occupancyRate = totalUnits > 0 ? ((occupiedUnits / totalUnits) * 100).toFixed(1) : '0';
      
      document.getElementById('totalStickers').textContent = totalStickers;
      document.getElementById('totalResidents').textContent = uniqueResidents;
      document.getElementById('totalBuildings').textContent = uniqueBuildings;
      document.getElementById('duplicateStickers').textContent = duplicates;
      document.getElementById('missingStickers').textContent = missing;
      document.getElementById('occupiedUnits').textContent = occupiedUnits;
      document.getElementById('vacantUnits').textContent = vacant;
      document.getElementById('occupancyRate').textContent = occupancyRate + '%';
    }

    function displayByResident() {
      const tbody = document.getElementById('residentTableBody');
      tbody.innerHTML = '';
      
      // Group by resident
      const residentGroups = {};
      allStickers.forEach(sticker => {
        const key = `${sticker.residentName}-${sticker.building}-${sticker.apartment}`;
        if (!residentGroups[key]) {
          residentGroups[key] = [];
        }
        residentGroups[key].push(sticker);
      });
      
      // Limit display to first 200 residents for performance
      const displayLimit = 200;
      let index = 1;
      let count = 0;
      
      for (const [key, stickers] of Object.entries(residentGroups)) {
        if (count >= displayLimit) break;
        
        stickers.forEach((sticker, i) => {
          const row = `
            <tr>
              <td>${index++}</td>
              <td>${sticker.residentName}</td>
              <td>${sticker.building}</td>
              <td>${sticker.apartment || '-'}</td>
              <td><span class="badge bg-primary">${sticker.stickerNumber}</span></td>
              <td>${sticker.plateNumber}</td>
              <td>${sticker.vehicleType || '-'}</td>
              <td><span class="badge bg-info">${stickers.length}</span></td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
        count++;
      }
      
      if (Object.keys(residentGroups).length > displayLimit) {
        tbody.innerHTML += `<tr><td colspan="8" class="text-center text-muted"><em>Ø¹Ø±Ø¶ ${displayLimit} Ù…Ù† ${Object.keys(residentGroups).length} Ø³Ø§ÙƒÙ†</em></td></tr>`;
      }
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
    }

    function displayByBuilding() {
      const tbody = document.getElementById('buildingTableBody');
      tbody.innerHTML = '';
      
      const buildingData = {};
      allStickers.forEach(sticker => {
        if (!sticker.building) return;
        
        if (!buildingData[sticker.building]) {
          buildingData[sticker.building] = {
            residents: new Set(),
            stickers: 0,
            units: new Set()
          };
        }
        buildingData[sticker.building].residents.add(sticker.residentName);
        buildingData[sticker.building].stickers++;
        // Only count apartments that are not '0' (villa indicator)
        if (sticker.apartment && sticker.apartment !== '0') {
          buildingData[sticker.building].units.add(sticker.apartment);
        }
      });
      
      let index = 1;
      Object.entries(buildingData).sort().forEach(([building, data]) => {
        // Estimate total units - if many apartments, likely apartment building (80 units)
        // If few or no apartments, likely villa area (20 units)
        const totalUnits = data.units.size > 10 ? 80 : 20;
        const occupied = data.units.size;
        const vacant = totalUnits - occupied;
        const rate = totalUnits > 0 ? ((occupied / totalUnits) * 100).toFixed(1) : '0';
        
        const row = `
          <tr>
            <td>${index++}</td>
            <td><strong>${building}</strong></td>
            <td>${data.residents.size}</td>
            <td>${data.stickers}</td>
            <td>${occupied}</td>
            <td>${vacant}</td>
            <td><span class="badge bg-success">${rate}%</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="7" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
    }

    function displayByUnit() {
      const tbody = document.getElementById('unitTableBody');
      tbody.innerHTML = '';
      
      const unitData = {};
      allStickers.forEach(sticker => {
        // Only process units with valid apartment numbers (not '0')
        if (sticker.apartment && sticker.apartment !== '0') {
          const key = `${sticker.building}-${sticker.apartment}`;
          if (!unitData[key]) {
            unitData[key] = {
              building: sticker.building,
              unit: sticker.apartment,
              resident: sticker.residentName,
              count: 0
            };
          }
          unitData[key].count++;
        }
      });
      
      let index = 1;
      Object.values(unitData).forEach(unit => {
        const row = `
          <tr>
            <td>${index++}</td>
            <td>${unit.building}</td>
            <td>${unit.unit}</td>
            <td>${unit.resident}</td>
            <td><span class="badge bg-info">${unit.count}</span></td>
            <td><span class="badge bg-success">Ù…Ø´ØºÙˆÙ„Ø©</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
    }

    function displayDuplicates() {
      const tbody = document.getElementById('duplicatesTableBody');
      tbody.innerHTML = '';
      
      const stickerGroups = {};
      allStickers.forEach(sticker => {
        if (!sticker.stickerNumber) return;
        
        if (!stickerGroups[sticker.stickerNumber]) {
          stickerGroups[sticker.stickerNumber] = [];
        }
        stickerGroups[sticker.stickerNumber].push(sticker);
      });
      
      let index = 1;
      let foundDuplicates = false;
      
      Object.entries(stickerGroups)
        .filter(([_, group]) => group.length > 1)
        .forEach(([stickerNum, group]) => {
          foundDuplicates = true;
          const uniqueResidents = [...new Set(group.map(s => s.residentName))];
          const isDifferentResident = uniqueResidents.length > 1;
          const badgeClass = isDifferentResident ? 'badge-duplicate' : 'badge-valid';
          const typeText = isDifferentResident ? 'ØªÙƒØ±Ø§Ø± ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ (Ø³ÙƒØ§Ù† Ù…Ø®ØªÙ„ÙÙˆÙ†)' : 'ØªÙƒØ±Ø§Ø± Ø·Ø¨ÙŠØ¹ÙŠ (Ù†ÙØ³ Ø§Ù„Ø³Ø§ÙƒÙ† - Ø³ÙŠØ§Ø±Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©)';
          
          const row = `
            <tr>
              <td>${index++}</td>
              <td><span class="badge bg-primary">${stickerNum}</span></td>
              <td><span class="badge ${badgeClass}">${group.length}</span></td>
              <td>${uniqueResidents.join(', ')}</td>
              <td><span class="badge ${badgeClass}">${typeText}</span></td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      
      if (!foundDuplicates) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center text-success"><i class="fas fa-check-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ØµÙ‚Ø§Øª Ù…ØªÙƒØ±Ø±Ø©</td></tr>';
      }
    }

    function displayMissing() {
      const tbody = document.getElementById('missingTableBody');
      tbody.innerHTML = '';
      
      let index = 1;
      let foundIssues = false;
      
      allStickers.forEach(sticker => {
        let problem = '';
        if (!sticker.stickerNumber || sticker.stickerNumber.length < 4) {
          problem = 'Ø±Ù‚Ù… Ù…Ù„ØµÙ‚ Ù†Ø§Ù‚Øµ';
        } else if (!sticker.plateNumber) {
          problem = 'Ø±Ù‚Ù… Ù„ÙˆØ­Ø© Ù…ÙÙ‚ÙˆØ¯';
        } else if (!/[0-9]/.test(sticker.stickerNumber)) {
          problem = 'Ù…Ù„ØµÙ‚ Ø¨Ø¯ÙˆÙ† Ø£Ø±Ù‚Ø§Ù…';
        }
        
        if (problem) {
          foundIssues = true;
          const row = `
            <tr>
              <td>${index++}</td>
              <td><span class="badge badge-missing">${sticker.stickerNumber || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span></td>
              <td>${sticker.residentName}</td>
              <td>${sticker.building}</td>
              <td>${sticker.apartment || '-'}</td>
              <td><span class="badge bg-danger">${problem}</span></td>
            </tr>
          `;
          tbody.innerHTML += row;
        }
      });
      
      if (!foundIssues) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-success"><i class="fas fa-check-circle"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ØµÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©</td></tr>';
      }
    }

    function displayMatching() {
      const tbody = document.getElementById('matchingTableBody');
      tbody.innerHTML = '';
      
      // Only show first 100 records for performance
      const displayLimit = 100;
      let index = 1;
      
      allStickers.slice(0, displayLimit).forEach(sticker => {
        const stickerDigits = sticker.stickerNumber.replace(/\D/g, '');
        const plateDigits = sticker.plateNumber.replace(/\D/g, '');
        const isMatch = stickerDigits === plateDigits;
        const badgeClass = isMatch ? 'bg-success' : 'bg-warning';
        const statusText = isMatch ? 'Ù…ØªØ·Ø§Ø¨Ù‚' : 'ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚';
        
        const row = `
          <tr>
            <td>${index++}</td>
            <td>${sticker.residentName}</td>
            <td><span class="badge bg-primary">${sticker.stickerNumber}</span></td>
            <td><span class="badge bg-info">${sticker.plateNumber}</span></td>
            <td><span class="badge ${badgeClass}">${statusText}</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      
      if (allStickers.length > displayLimit) {
        tbody.innerHTML += `<tr><td colspan="5" class="text-center text-muted"><em>Ø¹Ø±Ø¶ ${displayLimit} Ù…Ù† ${allStickers.length} Ø³Ø¬Ù„</em></td></tr>`;
      }
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
    }

    function displayOccupancy() {
      const tbody = document.getElementById('occupancyTableBody');
      tbody.innerHTML = '';
      
      const buildingOccupancy = {};
      allStickers.forEach(sticker => {
        if (!sticker.building) return;
        
        if (!buildingOccupancy[sticker.building]) {
          buildingOccupancy[sticker.building] = new Set();
        }
        // Only count apartments that are not '0' (villa indicator)
        if (sticker.apartment && sticker.apartment !== '0') {
          buildingOccupancy[sticker.building].add(sticker.apartment);
        }
      });
      
      let index = 1;
      let totalOccupied = 0;
      let totalVacant = 0;
      
      Object.entries(buildingOccupancy).sort().forEach(([building, units]) => {
        // Estimate total units based on occupied count
        const totalUnits = units.size > 10 ? 80 : 20;
        const occupied = units.size;
        const vacant = totalUnits - occupied;
        const rate = totalUnits > 0 ? ((occupied / totalUnits) * 100).toFixed(1) : '0';
        totalOccupied += occupied;
        totalVacant += vacant;
        
        const row = `
          <tr>
            <td>${index++}</td>
            <td><strong>${building}</strong></td>
            <td><span class="badge bg-success">${occupied}</span></td>
            <td><span class="badge bg-info">${vacant}</span></td>
            <td>${totalUnits}</td>
            <td><span class="badge bg-primary">${rate}%</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
      }
      
      document.getElementById('occupiedUnitsDetail').textContent = totalOccupied;
      document.getElementById('vacantUnitsDetail').textContent = totalVacant;
    }

    function populateFilters() {
      const buildings = [...new Set(allStickers.map(s => s.building).filter(b => b && b !== ''))].sort();
      
      const filters = ['filterBuilding', 'unitBuildingFilter'];
      filters.forEach(filterId => {
        const select = document.getElementById(filterId);
        // Clear existing options except the first one
        while (select.options.length > 1) {
          select.remove(1);
        }
        // Add building options
        buildings.forEach(building => {
          const option = document.createElement('option');
          option.value = building;
          option.textContent = building;
          select.appendChild(option);
        });
      });
    }

    function applyResidentFilter() {
      const searchTerm = document.getElementById('searchResident').value.toLowerCase();
      const buildingFilter = document.getElementById('filterBuilding').value;
      const multipleCarsFilter = document.getElementById('filterMultipleCars').value;
      
      const tbody = document.getElementById('residentTableBody');
      tbody.innerHTML = '';
      
      // Group by resident
      const residentGroups = {};
      allStickers.forEach(sticker => {
        const key = `${sticker.residentName}-${sticker.building}-${sticker.apartment}`;
        if (!residentGroups[key]) {
          residentGroups[key] = [];
        }
        residentGroups[key].push(sticker);
      });
      
      let index = 1;
      for (const [key, stickers] of Object.entries(residentGroups)) {
        const firstSticker = stickers[0];
        
        // Apply filters
        if (searchTerm && !firstSticker.residentName.toLowerCase().includes(searchTerm)) {
          continue;
        }
        if (buildingFilter && firstSticker.building !== buildingFilter) {
          continue;
        }
        if (multipleCarsFilter === 'multiple' && stickers.length <= 1) {
          continue;
        }
        if (multipleCarsFilter === 'single' && stickers.length > 1) {
          continue;
        }
        
        stickers.forEach((sticker) => {
          const row = `
            <tr>
              <td>${index++}</td>
              <td>${sticker.residentName}</td>
              <td>${sticker.building}</td>
              <td>${sticker.apartment || '-'}</td>
              <td><span class="badge bg-primary">${sticker.stickerNumber}</span></td>
              <td>${sticker.plateNumber}</td>
              <td>${sticker.vehicleType || '-'}</td>
              <td><span class="badge bg-info">${stickers.length}</span></td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      }
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="8" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«</td></tr>';
      }
    }

    function applyUnitFilter() {
      const buildingFilter = document.getElementById('unitBuildingFilter').value;
      const statusFilter = document.getElementById('unitStatusFilter').value;
      
      const tbody = document.getElementById('unitTableBody');
      tbody.innerHTML = '';
      
      const unitData = {};
      allStickers.forEach(sticker => {
        if (sticker.apartment && sticker.apartment !== '0') {
          const key = `${sticker.building}-${sticker.apartment}`;
          if (!unitData[key]) {
            unitData[key] = {
              building: sticker.building,
              unit: sticker.apartment,
              resident: sticker.residentName,
              count: 0
            };
          }
          unitData[key].count++;
        }
      });
      
      let index = 1;
      Object.values(unitData).forEach(unit => {
        // Apply filters
        if (buildingFilter && unit.building !== buildingFilter) {
          return;
        }
        if (statusFilter === 'vacant') {
          return; // Skip occupied units when showing vacant
        }
        
        const row = `
          <tr>
            <td>${index++}</td>
            <td>${unit.building}</td>
            <td>${unit.unit}</td>
            <td>${unit.resident}</td>
            <td><span class="badge bg-info">${unit.count}</span></td>
            <td><span class="badge bg-success">Ù…Ø´ØºÙˆÙ„Ø©</span></td>
          </tr>
        `;
        tbody.innerHTML += row;
      });
      
      if (index === 1) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø¨Ø­Ø«</td></tr>';
      }
    }

    function exportToExcel() {
      try {
        // Create workbook
        const wb = XLSX.utils.book_new();
        
        // Export statistics
        const statsData = [
          ['Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', ''],
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª', document.getElementById('totalStickers').textContent],
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙƒØ§Ù†', document.getElementById('totalResidents').textContent],
          ['Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', document.getElementById('totalBuildings').textContent],
          ['Ù…Ù„ØµÙ‚Ø§Øª Ù…ØªÙƒØ±Ø±Ø©', document.getElementById('duplicateStickers').textContent],
          ['Ù…Ù„ØµÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©', document.getElementById('missingStickers').textContent],
          ['ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©', document.getElementById('occupiedUnits').textContent],
          ['ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©', document.getElementById('vacantUnits').textContent],
          ['Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„', document.getElementById('occupancyRate').textContent]
        ];
        const wsStats = XLSX.utils.aoa_to_sheet(statsData);
        XLSX.utils.book_append_sheet(wb, wsStats, 'Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª');
        
        // Export by resident data
        const residentData = [['#', 'Ø§Ø³Ù… Ø§Ù„Ø³Ø§ÙƒÙ†', 'Ø§Ù„Ù…Ø¨Ù†Ù‰', 'Ø§Ù„ÙˆØ­Ø¯Ø©', 'Ø±Ù‚Ù… Ø§Ù„Ù…Ù„ØµÙ‚', 'Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©', 'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª']];
        const residentGroups = {};
        allStickers.forEach(sticker => {
          const key = `${sticker.residentName}-${sticker.building}-${sticker.apartment}`;
          if (!residentGroups[key]) {
            residentGroups[key] = [];
          }
          residentGroups[key].push(sticker);
        });
        
        let index = 1;
        for (const [key, stickers] of Object.entries(residentGroups)) {
          stickers.forEach(sticker => {
            residentData.push([
              index++,
              sticker.residentName,
              sticker.building,
              sticker.apartment || '-',
              sticker.stickerNumber,
              sticker.plateNumber,
              sticker.vehicleType || '-',
              stickers.length
            ]);
          });
        }
        const wsResident = XLSX.utils.aoa_to_sheet(residentData);
        XLSX.utils.book_append_sheet(wb, wsResident, 'Ø­Ø³Ø¨ Ø§Ù„Ø³Ø§ÙƒÙ†');
        
        // Export by building data
        const buildingData = [['#', 'Ø§Ù„Ù…Ø¨Ù†Ù‰', 'Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙƒØ§Ù†', 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª', 'ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©', 'ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„']];
        const buildingStats = {};
        allStickers.forEach(sticker => {
          if (!sticker.building) return;
          if (!buildingStats[sticker.building]) {
            buildingStats[sticker.building] = {
              residents: new Set(),
              stickers: 0,
              units: new Set()
            };
          }
          buildingStats[sticker.building].residents.add(sticker.residentName);
          buildingStats[sticker.building].stickers++;
          if (sticker.apartment && sticker.apartment !== '0') {
            buildingStats[sticker.building].units.add(sticker.apartment);
          }
        });
        
        index = 1;
        Object.entries(buildingStats).sort().forEach(([building, data]) => {
          const totalUnits = data.units.size > 10 ? 80 : 20;
          const occupied = data.units.size;
          const vacant = totalUnits - occupied;
          const rate = totalUnits > 0 ? ((occupied / totalUnits) * 100).toFixed(1) + '%' : '0%';
          
          buildingData.push([
            index++,
            building,
            data.residents.size,
            data.stickers,
            occupied,
            vacant,
            rate
          ]);
        });
        const wsBuilding = XLSX.utils.aoa_to_sheet(buildingData);
        XLSX.utils.book_append_sheet(wb, wsBuilding, 'Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù†Ù‰');
        
        // Save file
        const fileName = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(wb, fileName);
        
        alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ Excel Ø¨Ù†Ø¬Ø§Ø­');
      } catch (error) {
        console.error('Error exporting to Excel:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel');
      }
    }

    function exportToPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        
        // Add Arabic font support (using default for now)
        doc.setLanguage("ar");
        
        // Add title
        doc.setFontSize(18);
        doc.text('ØªÙ‚Ø±ÙŠØ± Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„', 105, 20, { align: 'center' });
        doc.setFontSize(12);
        doc.text(`ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}`, 105, 30, { align: 'center' });
        
        // Add statistics
        doc.setFontSize(14);
        doc.text('Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©', 105, 45, { align: 'center' });
        
        const stats = [
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª', document.getElementById('totalStickers').textContent],
          ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙƒØ§Ù†', document.getElementById('totalResidents').textContent],
          ['Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¨Ø§Ù†ÙŠ', document.getElementById('totalBuildings').textContent],
          ['Ù…Ù„ØµÙ‚Ø§Øª Ù…ØªÙƒØ±Ø±Ø©', document.getElementById('duplicateStickers').textContent],
          ['Ù…Ù„ØµÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©', document.getElementById('missingStickers').textContent],
          ['ÙˆØ­Ø¯Ø§Øª Ù…Ø´ØºÙˆÙ„Ø©', document.getElementById('occupiedUnits').textContent],
          ['ÙˆØ­Ø¯Ø§Øª Ø´Ø§ØºØ±Ø©', document.getElementById('vacantUnits').textContent],
          ['Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„', document.getElementById('occupancyRate').textContent]
        ];
        
        doc.autoTable({
          startY: 50,
          head: [['Ø§Ù„Ø¨ÙŠØ§Ù†', 'Ø§Ù„Ù‚ÙŠÙ…Ø©']],
          body: stats,
          styles: { font: 'helvetica', halign: 'center' },
          headStyles: { fillColor: [107, 85, 54] }
        });
        
        // Add by building table
        let finalY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(14);
        doc.text('ØªÙ‚Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¨Ù†Ù‰', 105, finalY, { align: 'center' });
        
        const buildingStats = {};
        allStickers.forEach(sticker => {
          if (!sticker.building) return;
          if (!buildingStats[sticker.building]) {
            buildingStats[sticker.building] = {
              residents: new Set(),
              stickers: 0,
              units: new Set()
            };
          }
          buildingStats[sticker.building].residents.add(sticker.residentName);
          buildingStats[sticker.building].stickers++;
          if (sticker.apartment && sticker.apartment !== '0') {
            buildingStats[sticker.building].units.add(sticker.apartment);
          }
        });
        
        const buildingData = [];
        Object.entries(buildingStats).sort().forEach(([building, data]) => {
          const totalUnits = data.units.size > 10 ? 80 : 20;
          const occupied = data.units.size;
          const vacant = totalUnits - occupied;
          const rate = totalUnits > 0 ? ((occupied / totalUnits) * 100).toFixed(1) + '%' : '0%';
          
          buildingData.push([
            building,
            data.residents.size,
            data.stickers,
            occupied,
            vacant,
            rate
          ]);
        });
        
        doc.autoTable({
          startY: finalY + 5,
          head: [['Ø§Ù„Ù…Ø¨Ù†Ù‰', 'Ø§Ù„Ø³ÙƒØ§Ù†', 'Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª', 'Ù…Ø´ØºÙˆÙ„Ø©', 'Ø´Ø§ØºØ±Ø©', 'Ù†Ø³Ø¨Ø© Ø§Ù„Ø¥Ø´ØºØ§Ù„']],
          body: buildingData.slice(0, 30), // Limit to 30 buildings for PDF
          styles: { font: 'helvetica', halign: 'center', fontSize: 9 },
          headStyles: { fillColor: [107, 85, 54] }
        });
        
        // Add footer
        const pageCount = doc.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
          doc.setPage(i);
          doc.setFontSize(10);
          doc.text(`ØµÙØ­Ø© ${i} Ù…Ù† ${pageCount}`, 105, 285, { align: 'center' });
        }
        
        // Save file
        const fileName = `ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ù„ØµÙ‚Ø§Øª_${new Date().toISOString().split('T')[0]}.pdf`;
        doc.save(fileName);
        
        alert('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¥Ù„Ù‰ PDF Ø¨Ù†Ø¬Ø§Ø­');
      } catch (error) {
        console.error('Error exporting to PDF:', error);
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF');
      }
    }
  </script>
  
  <script src="../js/print-template.js"></script>
  <script>
    // Initialize print template
    PrintTemplate.init({
      reportTitle: 'ØªÙ‚Ø±ÙŠØ± Ù…Ù„ØµÙ‚Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„',
      reportSubtitle: 'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ù…Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ù† Ø³Ø¹ÙˆØ¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©',
      showDate: true,
      showLogo: true
    });
    
    // Apply print preparation
    PrintTemplate.prepareTable('table');
    PrintTemplate.preventPageBreak('.stat-card');
    PrintTemplate.preventPageBreak('.report-section');
  </script>
</body>
</html>
